<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>6. Advanced Routing Queries &#8212; Workshop - FOSS4G 2017 Dar Es Salaam - Routing with pgRouting</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.4.11',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. Writing a SQL Stored Procedures" href="SQLfunction.html" />
    <link rel="prev" title="5. pgRouting Algorithms" href="shortest_path.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/pgrouting.png"></span>
          Workshop FOSS4G Dar Es Salaam</a>
        <span class="navbar-text navbar-version pull-left"><b>2.4</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Chapters <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">2. About The Workshop</a><ul>
<li class="toctree-l2"><a class="reference internal" href="about.html#pgrouting-overview">2.1. pgRouting Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#osm2pgrouting-overview">2.2. osm2pgrouting Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#openstreetmap-overview">2.3. OpenStreetMap Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">3. Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#osgeo-live-on-a-virtualbox">3.1. OSGeo Live on a virtualBox</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="prepare_data.html">4. Prepare Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="prepare_data.html#prepare-the-database">4.1. Prepare the database</a></li>
<li class="toctree-l2"><a class="reference internal" href="prepare_data.html#get-the-workshop-data">4.2. Get the Workshop Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="prepare_data.html#upload-data-to-the-database">4.3. Upload Data to the database</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="shortest_path.html">5. pgRouting Algorithms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="shortest_path.html#pgr-dijkstra">5.1. pgr_dijkstra</a></li>
<li class="toctree-l2"><a class="reference internal" href="shortest_path.html#pgr-dijkstracost">5.2. pgr_dijkstraCost</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">6. Advanced Routing Queries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#routing-for-vehicles">6.1. Routing for Vehicles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cost-manipulations">6.2. Cost Manipulations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="SQLfunction.html">7. Writing a SQL Stored Procedures</a><ul>
<li class="toctree-l2"><a class="reference internal" href="SQLfunction.html#the-application-requirements">7.1. The application requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="SQLfunction.html#geometry-handling">7.2. Geometry handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="SQLfunction.html#creating-a-function">7.3. Creating a Function</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="function.html">8. Writing a pl/pgsql Stored Procedures</a><ul>
<li class="toctree-l2"><a class="reference internal" href="function.html#requirements-for-routing-from-a-to-b">8.1. Requirements for Routing from A to B</a></li>
<li class="toctree-l2"><a class="reference internal" href="function.html#the-vertex-table">8.2. The Vertex Table</a></li>
<li class="toctree-l2"><a class="reference internal" href="function.html#wrk-fromatob-function">8.3. wrk_fromAtoB function</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usingQgis.html">9. Using Qgis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="usingQgis.html#set-up-qgis">9.1. Set Up QGIS</a></li>
<li class="toctree-l2"><a class="reference internal" href="usingQgis.html#add-a-postgis-layer">9.2. Add a postGIS Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="usingQgis.html#format-a-routing-layer">9.3. Format a Routing Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="usingQgis.html#copy-paste-format">9.4. Copy/Paste Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="usingQgis.html#save-the-project">9.5. Save the project</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="geoserver.html">10. WMS server with GeoServer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="geoserver.html#connect-to-the-administration-page">10.1. Connect to the administration page</a></li>
<li class="toctree-l2"><a class="reference internal" href="geoserver.html#create-the-layer">10.2. Create the layer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ol3_client.html">11. OpenLayers 3 Based Routing Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ol3_client.html#openlayers-3-introduction">11.1. OpenLayers 3 introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="ol3_client.html#creating-a-minimal-map">11.2. Creating a minimal map</a></li>
<li class="toctree-l2"><a class="reference internal" href="ol3_client.html#wms-get-parameters">11.3. WMS GET parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="ol3_client.html#select-start-and-destination">11.4. Select “start” and “destination”</a></li>
<li class="toctree-l2"><a class="reference internal" href="ol3_client.html#clear-the-results">11.5. Clear the results</a></li>
<li class="toctree-l2"><a class="reference internal" href="ol3_client.html#summary-full-example">11.6. Summary (full example)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="topology.html">12. Create a Network Topology</a><ul>
<li class="toctree-l2"><a class="reference internal" href="topology.html#load-network-data">12.1. Load network data</a></li>
<li class="toctree-l2"><a class="reference internal" href="topology.html#create-a-routing-network-topology">12.2. Create a Routing Network Topology</a></li>
<li class="toctree-l2"><a class="reference internal" href="topology.html#verify-the-routing-network-topology">12.3. Verify the Routing Network Topology</a></li>
<li class="toctree-l2"><a class="reference internal" href="topology.html#analyze-and-adjust-the-routing-network-topology">12.4. Analyze and Adjust the Routing Network Topology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="the_solutions.html">13. Appendix: Workshop Solutions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="the_solutions.html#pgrouting-algorithms-solutions">13.1. <code class="docutils literal"><span class="pre">pgRouting</span> <span class="pre">Algorithms</span></code> Solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="the_solutions.html#advanced-routing-queries-solutions">13.2. <code class="docutils literal"><span class="pre">Advanced</span> <span class="pre">Routing</span> <span class="pre">Queries</span></code> Solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="the_solutions.html#solutions-to-writing-a-sql-stored-procedures-chapter">13.3. Solutions to <code class="docutils literal"><span class="pre">Writing</span> <span class="pre">a</span> <span class="pre">SQL</span> <span class="pre">Stored</span> <span class="pre">Procedures</span></code> Chapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="the_solutions.html#solutions-to-writing-a-pl-pgsql-stored-procedures-chapter">13.4. Solutions to <code class="docutils literal"><span class="pre">Writing</span> <span class="pre">a</span> <span class="pre">pl/pgsql</span> <span class="pre">Stored</span> <span class="pre">Procedures</span></code> Chapter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="additional_installation.html">14. Appendix: Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="osm2pgrouting.html">15. Appendix: osm2pgrouting Import Tool</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">6. Advanced Routing Queries</a><ul>
<li><a class="reference internal" href="#routing-for-vehicles">6.1. Routing for Vehicles</a><ul>
<li><a class="reference internal" href="#exercise-7-vehicle-routing-going">6.1.1. Exercise 7 - Vehicle routing - Going</a></li>
<li><a class="reference internal" href="#exercise-8-vehicle-routing-returning">6.1.2. Exercise 8 - Vehicle routing - Returning</a></li>
<li><a class="reference internal" href="#exercise-9-vehicle-routing-when-time-is-money">6.1.3. Exercise 9 - Vehicle routing when “time is money”</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cost-manipulations">6.2. Cost Manipulations</a><ul>
<li><a class="reference internal" href="#exercise-10-vehicle-routing-with-access-restrictions">6.2.1. Exercise 10 - Vehicle routing with access restrictions</a></li>
<li><a class="reference internal" href="#exercise-11-vehicle-routing-with-penalization">6.2.2. Exercise 11 - Vehicle routing with penalization</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="shortest_path.html" title="Previous Chapter: 5. pgRouting Algorithms"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 5. pgRouting ...</span>
    </a>
  </li>
  <li>
    <a href="SQLfunction.html" title="Next Chapter: 7. Writing a SQL Stored Procedures"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">7. Writing a ... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="advanced-routing-queries">
<h1><a class="toc-backref" href="#id1">6. Advanced Routing Queries</a><a class="headerlink" href="#advanced-routing-queries" title="Permalink to this headline">¶</a></h1>
<a class="reference internal image-reference" href="../_images/route.png"><img alt="../_images/route.png" class="align-center" src="../_images/route.png" style="width: 300pt;" /></a>
<p>Routing, is not limited to pedestrians and most of the time is used for routing vehicles.</p>
<div class="contents topic" id="chapter-contents">
<p class="topic-title first">Chapter Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#advanced-routing-queries" id="id1">Advanced Routing Queries</a><ul>
<li><a class="reference internal" href="#routing-for-vehicles" id="id2">Routing for Vehicles</a><ul>
<li><a class="reference internal" href="#exercise-7-vehicle-routing-going" id="id3">Exercise 7 - Vehicle routing - Going</a></li>
<li><a class="reference internal" href="#exercise-8-vehicle-routing-returning" id="id4">Exercise 8 - Vehicle routing - Returning</a></li>
<li><a class="reference internal" href="#exercise-9-vehicle-routing-when-time-is-money" id="id5">Exercise 9 - Vehicle routing when “time is money”</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cost-manipulations" id="id6">Cost Manipulations</a><ul>
<li><a class="reference internal" href="#exercise-10-vehicle-routing-with-access-restrictions" id="id7">Exercise 10 - Vehicle routing with access restrictions</a></li>
<li><a class="reference internal" href="#exercise-11-vehicle-routing-with-penalization" id="id8">Exercise 11 - Vehicle routing with penalization</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="routing-for-vehicles">
<h2><a class="toc-backref" href="#id2">6.1. Routing for Vehicles</a><a class="headerlink" href="#routing-for-vehicles" title="Permalink to this headline">¶</a></h2>
<p>A query for vehicle routing generally differs from routing for pedestrians:</p>
<ul class="simple">
<li>the road segments are considered <cite>directed</cite>,</li>
<li>Costs can be:<ul>
<li>Distance</li>
<li>Time</li>
<li>Euros</li>
<li>Pesos</li>
<li>Dollars</li>
<li>CO2 emittions</li>
<li>Ware and tear on the vehicle, etc.</li>
</ul>
</li>
<li>the <cite>reverse_cost</cite> attribute must be taken into account on two way streets.</li>
</ul>
<p>This is due to the fact that there are roads that
are “one way”.</p>
<p>Depending on the geometry, the valid way:</p>
<ul class="simple">
<li>(source, target) segment (<code class="docutils literal"><span class="pre">cost</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code> and <code class="docutils literal"><span class="pre">reverse_cost</span> <span class="pre">&lt;</span> <span class="pre">0</span></code>)</li>
<li>(target, source) segment (<code class="docutils literal"><span class="pre">cost</span> <span class="pre">&lt;</span> <span class="pre">0</span></code> and <code class="docutils literal"><span class="pre">reverse_cost</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code>)</li>
</ul>
<p>So a “wrong way” is indicated with a <strong>negative value</strong> and is not inserted in the
graph for processing.</p>
<p>For two way roads <code class="docutils literal"><span class="pre">cost</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code> and <code class="docutils literal"><span class="pre">reverse_cost</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code> and their values can
be different. For example, it is faster going down hill on a sloped road.
In general <code class="docutils literal"><span class="pre">cost</span></code> and <code class="docutils literal"><span class="pre">reverse_cost</span></code> do not need to be length; they can be
almost anything, for example time, slope, surface, road type, etc., or they can
be a combination of multiple parameters.</p>
<p class="rubric">The following queries indicate the number of road segments, where a “one way” rule applies:</p>
<ol class="arabic">
<li><p class="first">Number of (source, target) segments with <code class="docutils literal"><span class="pre">cost</span> <span class="pre">&lt;</span> <span class="pre">0</span></code></p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">ways</span>
<span class="k">WHERE</span> <span class="n">cost</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
    <span class="mi">37</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</li>
<li><p class="first">Number of (target, source) segments with <code class="docutils literal"><span class="pre">reverse_cost</span> <span class="pre">&lt;</span> <span class="pre">0</span></code></p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">ways</span>
<span class="k">WHERE</span> <span class="n">reverse_cost</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
    <span class="mi">37</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</li>
</ol>
<div class="section" id="exercise-7-vehicle-routing-going">
<span id="exercise-7"></span><h3><a class="toc-backref" href="#id3">6.1.1. Exercise 7 - Vehicle routing - Going</a><a class="headerlink" href="#exercise-7-vehicle-routing-going" title="Permalink to this headline">¶</a></h3>
<p class="rubric">From the Venue, going to the Brewry by car.</p>
<a class="reference internal image-reference" href="../_images/ad7.png"><img alt="From the Venue, going to the Brewry by car" src="../_images/ad7.png" style="width: 300pt;" /></a>
<ul class="simple">
<li>The vehicle is going from vertex <code class="docutils literal"><span class="pre">3986</span></code> to vertex <code class="docutils literal"><span class="pre">13009</span></code>.</li>
<li>Use <code class="docutils literal"><span class="pre">cost</span></code> and <code class="docutils literal"><span class="pre">reverse_cost</span></code> columns, which are in unit <code class="docutils literal"><span class="pre">degrees</span></code>.</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">pgr_dijkstra</span><span class="p">(</span>
    <span class="s1">&#39;SELECT gid AS id,</span>
<span class="s1">         source,</span>
<span class="s1">         target,</span>
<span class="s1">         cost_s AS cost,</span>
<span class="s1">         reverse_cost_s AS reverse_cost</span>
<span class="s1">        FROM ways&#39;</span><span class="p">,</span>
    <span class="mi">3986</span><span class="p">,</span> <span class="mi">13009</span><span class="p">,</span>
    <span class="n">directed</span> <span class="p">:</span><span class="o">=</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
<p><a class="reference internal" href="the_solutions.html#solution-to-exercise-7"><span class="std std-ref">Solution to Exercise 7</span></a></p>
</div>
<div class="section" id="exercise-8-vehicle-routing-returning">
<span id="exercise-8"></span><h3><a class="toc-backref" href="#id4">6.1.2. Exercise 8 - Vehicle routing - Returning</a><a class="headerlink" href="#exercise-8-vehicle-routing-returning" title="Permalink to this headline">¶</a></h3>
<p class="rubric">From the Brewry, going to the Venue by car.</p>
<a class="reference internal image-reference" href="../_images/ad8.png"><img alt="From the Brewry, going to the Venue by car" src="../_images/ad8.png" style="width: 300pt;" /></a>
<ul class="simple">
<li>The vehicle is going from vertex <code class="docutils literal"><span class="pre">13009</span></code> to vertex <code class="docutils literal"><span class="pre">3986</span></code>.</li>
<li>Use <code class="docutils literal"><span class="pre">cost</span></code> and <code class="docutils literal"><span class="pre">reverse_cost</span></code> columns, which are in unit <code class="docutils literal"><span class="pre">degrees</span></code>.</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">pgr_dijkstra</span><span class="p">(</span>
    <span class="s1">&#39;SELECT gid AS id,</span>
<span class="s1">         source,</span>
<span class="s1">         target,</span>
<span class="s1">         cost_s AS cost,</span>
<span class="s1">         reverse_cost_s AS reverse_cost</span>
<span class="s1">        FROM ways&#39;</span><span class="p">,</span>
    <span class="mi">13009</span><span class="p">,</span> <span class="mi">3986</span><span class="p">,</span> <span class="n">directed</span> <span class="p">:</span><span class="o">=</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
<p><a class="reference internal" href="the_solutions.html#solution-to-exercise-8"><span class="std std-ref">Solution to Exercise 8</span></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On a directed graph, going and coming back routes, most of the time are different.</p>
</div>
</div>
<div class="section" id="exercise-9-vehicle-routing-when-time-is-money">
<span id="exercise-9"></span><h3><a class="toc-backref" href="#id5">6.1.3. Exercise 9 - Vehicle routing when “time is money”</a><a class="headerlink" href="#exercise-9-vehicle-routing-when-time-is-money" title="Permalink to this headline">¶</a></h3>
<p class="rubric">From the Brewry, going to the Venue by taxi. Fee: $100/hour</p>
<a class="reference internal image-reference" href="../_images/ad9.png"><img alt="From the Brewry, going to the Venue by car" src="../_images/ad9.png" style="width: 300pt;" /></a>
<ul class="simple">
<li>The vehicle is going from vertex <code class="docutils literal"><span class="pre">13009</span></code> to vertex <code class="docutils literal"><span class="pre">3986</span></code>.</li>
<li>The cost is <code class="docutils literal"><span class="pre">$100</span> <span class="pre">per</span> <span class="pre">hour</span></code>.</li>
<li>Use <code class="docutils literal"><span class="pre">cost_s</span></code> and <code class="docutils literal"><span class="pre">reverse_cost_s</span></code> columns, which are in unit <code class="docutils literal"><span class="pre">seconds</span></code>.</li>
<li>The duration in hours is <code class="docutils literal"><span class="pre">cost</span> <span class="pre">/</span> <span class="pre">3600</span></code></li>
<li>The cost in <code class="docutils literal"><span class="pre">$</span></code> is <code class="docutils literal"><span class="pre">cost</span> <span class="pre">/</span> <span class="pre">3600</span> <span class="pre">*</span> <span class="pre">100</span></code></li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">pgr_dijkstra</span><span class="p">(</span><span class="s1">&#39;</span>
<span class="s1">    SELECT gid AS id,</span>
<span class="s1">        source,</span>
<span class="s1">        target,</span>
<span class="s1">        cost_s / 3600 * 100 AS cost,</span>
<span class="s1">        reverse_cost_s / 3600 * 100 AS reverse_cost</span>
<span class="s1">        FROM ways&#39;</span><span class="p">,</span>
     <span class="mi">13009</span><span class="p">,</span> <span class="mi">3986</span><span class="p">);</span>
</pre></div>
</div>
<p><a class="reference internal" href="the_solutions.html#solution-to-exercise-9"><span class="std std-ref">Solution to Exercise 9</span></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Comparing with <a class="reference internal" href="#exercise-8"><span class="std std-ref">Exercise 8</span></a>:</p>
<ul class="last simple">
<li>The total number of records are identical</li>
<li>The node sequence is identical</li>
<li>The edge sequence is identical</li>
<li>The cost and agg_cost results are directly proportional</li>
</ul>
</div>
</div>
</div>
<div class="section" id="cost-manipulations">
<span id="modify"></span><h2><a class="toc-backref" href="#id6">6.2. Cost Manipulations</a><a class="headerlink" href="#cost-manipulations" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="../_images/detailofroute9.png"><img alt="Detail. Not all crossings are vertices in the graph" src="../_images/detailofroute9.png" style="width: 300pt;" /></a>
<p>When dealing with data, being aware of what kind of data is being used, can improve results.
Vehciles can not circulate pedestrian ways, likewise, routing not using pedestrian ways
will make the results closer to reality.</p>
<p>When converting data from OSM format using the osm2pgrouting tool, there are two
additional tables: <code class="docutils literal"><span class="pre">osm_way_types</span></code> and <code class="docutils literal"><span class="pre">osm_way_classes</span></code>:</p>
<p class="rubric">osm_way_types</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">osm_way_types</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">type_id</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="n">type_id</span> <span class="o">|</span>   <span class="n">name</span>    
<span class="o">---------+-----------</span>
       <span class="mi">1</span> <span class="o">|</span> <span class="n">highway</span>
       <span class="mi">2</span> <span class="o">|</span> <span class="n">cycleway</span>
       <span class="mi">3</span> <span class="o">|</span> <span class="n">tracktype</span>
       <span class="mi">4</span> <span class="o">|</span> <span class="n">junction</span>
<span class="p">(</span><span class="mi">4</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p class="rubric">osm_way_classes</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">osm_way_classes</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">class_id</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="n">class_id</span> <span class="o">|</span> <span class="n">type_id</span> <span class="o">|</span>       <span class="n">name</span>        <span class="o">|</span> <span class="n">priority</span> <span class="o">|</span> <span class="n">default_maxspeed</span> 
<span class="o">----------+---------+-------------------+----------+------------------</span>
      <span class="mi">100</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">road</span>              <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">101</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">motorway</span>          <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">102</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">motorway_link</span>     <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">103</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">motorway_junction</span> <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">104</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">trunk</span>             <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">105</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">trunk_link</span>        <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">106</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">primary</span>           <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">107</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">primary_link</span>      <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">108</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">secondary</span>         <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">109</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">tertiary</span>          <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">110</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">residential</span>       <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">111</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">living_street</span>     <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">112</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">service</span>           <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">113</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">track</span>             <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">114</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">pedestrian</span>        <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">115</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">services</span>          <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">116</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">bus_guideway</span>      <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">117</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">path</span>              <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">118</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">cycleway</span>          <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">119</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">footway</span>           <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">120</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">bridleway</span>         <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">121</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">byway</span>             <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">122</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">steps</span>             <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">123</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">unclassified</span>      <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">124</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">secondary_link</span>    <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">125</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">tertiary_link</span>     <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">201</span> <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span> <span class="n">lane</span>              <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">202</span> <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span> <span class="n">track</span>             <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">203</span> <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span> <span class="n">opposite_lane</span>     <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">204</span> <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span> <span class="n">opposite</span>          <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">301</span> <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span> <span class="n">grade1</span>            <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">302</span> <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span> <span class="n">grade2</span>            <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">303</span> <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span> <span class="n">grade3</span>            <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">304</span> <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span> <span class="n">grade4</span>            <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">305</span> <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span> <span class="n">grade5</span>            <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">401</span> <span class="o">|</span>       <span class="mi">4</span> <span class="o">|</span> <span class="n">roundabout</span>        <span class="o">|</span>        <span class="mi">0</span> <span class="o">|</span>               <span class="mi">50</span>
<span class="p">(</span><span class="mi">36</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>In this workshop, costs are going to be manipulated using the <code class="docutils literal"><span class="pre">osm_way_classes</span></code> tables.</p>
<div class="section" id="exercise-10-vehicle-routing-with-access-restrictions">
<span id="exercise-10"></span><h3><a class="toc-backref" href="#id7">6.2.1. Exercise 10 - Vehicle routing with access restrictions</a><a class="headerlink" href="#exercise-10-vehicle-routing-with-access-restrictions" title="Permalink to this headline">¶</a></h3>
<p class="rubric">From the Brewry, going to the Venue, vehicle can not take pedestrian roads.</p>
<a class="reference internal image-reference" href="../_images/ad10.png"><img alt="From the Brewry, going to the Venue by car" src="../_images/ad10.png" style="width: 300pt;" /></a>
<ul class="simple">
<li>The vehicle is going from vertex <code class="docutils literal"><span class="pre">13009</span></code> to vertex <code class="docutils literal"><span class="pre">3986</span></code>.</li>
<li>The vehicle’s cost in this case will be in seconds.</li>
<li>Pedestrian ways will not be inserted by setting <code class="docutils literal"><span class="pre">cost</span></code> and <code class="docutils literal"><span class="pre">reverse_cost</span></code> to a negative value</li>
<li>Use <code class="docutils literal"><span class="pre">CASE</span></code> to assign the negative value.</li>
<li><code class="docutils literal"><span class="pre">cost</span></code> and <code class="docutils literal"><span class="pre">reverse_cost</span></code> must have the same <code class="docutils literal"><span class="pre">CASE</span></code></li>
<li>There is no need to rebuild the network.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">CASE</span></code> statements are like <code class="docutils literal"><span class="pre">switch</span></code> statements in other languages</p>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>
SELECT * FROM pgr_dijkstra($$
    SELECT gid AS id,
        source,
        target,
        CASE
            WHEN c.name IN (&#39;pedestrian&#39;,&#39;steps&#39;,&#39;footway&#39;) THEN -1
            ELSE cost_s
        END AS cost,
        CASE
            WHEN c.name IN (&#39;pedestrian&#39;,&#39;steps&#39;,&#39;footway&#39;) THEN -1
            ELSE reverse_cost_s
        END AS reverse_cost
        FROM ways JOIN osm_way_classes AS c
        USING (class_id)$$,
    13009, 3986);

</pre></div>
</div>
<p><a class="reference internal" href="the_solutions.html#solution-to-exercise-10"><span class="std std-ref">Solution to Exercise 10</span></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Comparing with <a class="reference internal" href="#exercise-9"><span class="std std-ref">Exercise 9</span></a>:</p>
<ul class="last simple">
<li>The total number of records changed.</li>
<li>The node sequence changed.</li>
<li>The edge sequence changed.</li>
</ul>
</div>
</div>
<div class="section" id="exercise-11-vehicle-routing-with-penalization">
<span id="exercise-11"></span><h3><a class="toc-backref" href="#id8">6.2.2. Exercise 11 - Vehicle routing with penalization</a><a class="headerlink" href="#exercise-11-vehicle-routing-with-penalization" title="Permalink to this headline">¶</a></h3>
<p class="rubric">From the Brewry, going to the Venue with penalization.</p>
<a class="reference internal image-reference" href="../_images/ad11.png"><img alt="From the Brewry, going to the Venue by car" src="../_images/ad11.png" style="width: 300pt;" /></a>
<p>Change the cost values for the <code class="code docutils literal"><span class="pre">osm_way_classes</span></code> table, in such a way, that the use
of “faster” roads is encouraged.</p>
<ul class="simple">
<li>Creating an addition column <code class="docutils literal"><span class="pre">penalty</span></code></li>
<li>The <code class="docutils literal"><span class="pre">penalty</span></code> values can be changed <code class="docutils literal"><span class="pre">UPDATE</span></code> queries.</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">osm_way_classes</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">penalty</span> <span class="nb">FLOAT</span><span class="p">;</span>
<span class="c1">-- No penalty</span>
<span class="k">UPDATE</span> <span class="n">osm_way_classes</span> <span class="k">SET</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="c1">-- Not including pedestrian ways</span>
<span class="k">UPDATE</span> <span class="n">osm_way_classes</span> <span class="k">SET</span> <span class="n">penalty</span><span class="o">=-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;pedestrian&#39;</span><span class="p">,</span><span class="s1">&#39;steps&#39;</span><span class="p">,</span><span class="s1">&#39;footway&#39;</span><span class="p">);</span>
<span class="c1">-- Penalizing with double costs</span>
<span class="k">UPDATE</span> <span class="n">osm_way_classes</span> <span class="k">SET</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">1</span><span class="p">.</span><span class="mi">5</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;cicleway&#39;</span><span class="p">,</span><span class="s1">&#39;living_street&#39;</span><span class="p">,</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
<span class="c1">-- Encuraging the use of &quot;fast&quot; roads</span>
<span class="k">UPDATE</span> <span class="n">osm_way_classes</span> <span class="k">SET</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;secondary&#39;</span><span class="p">,</span><span class="s1">&#39;tertiary&#39;</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">osm_way_classes</span> <span class="k">SET</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;primary&#39;</span><span class="p">,</span><span class="s1">&#39;primary_link&#39;</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">osm_way_classes</span> <span class="k">SET</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">4</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;trunk&#39;</span><span class="p">,</span><span class="s1">&#39;trunk_link&#39;</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">osm_way_classes</span> <span class="k">SET</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;motorway&#39;</span><span class="p">,</span><span class="s1">&#39;motorway_junction&#39;</span><span class="p">,</span><span class="s1">&#39;motorway_link&#39;</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li>The vehicle is going from vertex <code class="docutils literal"><span class="pre">13009</span></code> to vertex <code class="docutils literal"><span class="pre">3986</span></code>.</li>
<li>Use <code class="docutils literal"><span class="pre">cost_s</span></code> and <code class="docutils literal"><span class="pre">reverse_cost_s</span></code> columns, which are in unit <code class="docutils literal"><span class="pre">seconds</span></code>.</li>
<li>Costs are to be multiplied by <code class="code docutils literal"><span class="pre">penalty</span></code></li>
<li>The <code class="code docutils literal"><span class="pre">osm_way_classes</span></code> table is linked with the <code class="code docutils literal"><span class="pre">ways</span></code> table by the
<code class="code docutils literal"><span class="pre">class_id</span></code> field using a <code class="docutils literal"><span class="pre">JOIN</span></code>.</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">pgr_dijkstra</span><span class="p">(</span><span class="s1">&#39;</span>
<span class="s1">    SELECT gid AS id,</span>
<span class="s1">        source,</span>
<span class="s1">        target,</span>
<span class="s1">        cost_s * penalty AS cost,</span>
<span class="s1">        reverse_cost_s * penalty AS reverse_cost</span>
<span class="s1">    FROM ways JOIN osm_way_classes</span>
<span class="s1">    USING (class_id)&#39;</span><span class="p">,</span>
    <span class="mi">13009</span><span class="p">,</span> <span class="mi">3986</span><span class="p">);</span>
</pre></div>
</div>
<p><a class="reference internal" href="the_solutions.html#solution-to-exercise-11"><span class="std std-ref">Solution to Exercise 11</span></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Comparing with <a class="reference internal" href="#exercise-9"><span class="std std-ref">Exercise 9</span></a>:</p>
<ul class="last simple">
<li>The total number of records changed.</li>
<li>The node sequence changed.</li>
<li>The edge sequence changed.</li>
</ul>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2010-2017 Daniel Kastl, Vicky Vergara.<br/>
      Last updated on Sep 25, 2018.<br/>
    </p>
  </div>
</footer>
  </body>
</html>